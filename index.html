<!DOCTYPE html>
<html lang="en">
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
	</head>
	<body>
		<canvas id="canvas" width="757" height="600" style="border: 1px solid black;">
			<img id="source" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg/757px-Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg">
			<img id="star" src="https://marketplace.canva.com/MACySNBkdKQ/1/thumbnail_large/canva-doodle-video-game-star-character-icon-MACySNBkdKQ.png">
			<img id="basket" src="https://img.heypik.com/background/20180814/heypik-preparation-transparent-basket-cartoon_27730082.png?x-oss-process=image/watermark,image_c2h1aXlpbl9uZXcucG5n,g_center">
			<script type="text/javascript" src="basket.js"></script>
			<script type="text/javascript" src="stars.js"></script>
		</canvas>
		<script type="text/javascript">


			var keysdown = {};

			window.addEventListener("keydown", function (event) {
				if (event.defaultPrevented) {
				return;
				}
				keysdown[event.key] = true;
				event.preventDefault();
			}, true);


			window.addEventListener("keyup", function (event) {
				if (event.defaultPrevented) {
				return; // Do nothing if the event was already processed
				}
				keysdown[event.key] = false;
				event.preventDefault();
			}, true);

			$(window).bind("load", function() {

				//Variables representing the canvas and the canvas' context (the context is used for actually drawing on the canvas)
				var canvas = document.getElementById("canvas");
				var context = canvas.getContext("2d");

				var stars = []
				var basket_obj = new Basket(context);
				stars.push(new Stars(context, basket_obj, 10, 10));
				stars.push(new Stars(context, basket_obj, 300, 10));
				stars.push(new Stars(context, basket_obj, 500, 10));

				var fps = 0;
				var framesThisSecond = 0;

				setInterval(function() { fps = framesThisSecond; framesThisSecond = 0; }, 1000);
				//start drawing the first frame
				requestAnimationFrame(mainLoop);

				//Game Loop
				function mainLoop() {
					processInput();
					update();
					draw();
					requestAnimationFrame(mainLoop); //keep reiterating through this loop
				}

				//Handle user input by adjusting ball velocity based on keys pressed
				function processInput()
				{
					if(keysdown.ArrowLeft) {
						basket_obj.pX = basket_obj.pX - 10 ;
					}


					if (keysdown.ArrowRight) {
						basket_obj.pX = basket_obj.pX + 10;
					}
				}

				//Here is where we would update the state of our game or simulation (e.g., make the copters move).
				function update() {
					stars.forEach(function(c) { c.update();})
					basket_obj.update();
				}

				//Draw the scene. Here we simply erase what was previously drawn (e.g., where the copters used to be), then draw it again
				function draw() {

					//clear our drawing
					context.clearRect(0, 0, canvas.width, canvas.height);

					context.globalAlpha = 0.5;

					var image = document.getElementById('source');
					context.drawImage(image,0,0);

					context.globalAlpha = 1;

					//save the coordinate frame (in case we wanted to draw other things after the copters)
					context.save();

					stars.forEach(function(c) { c.draw(); })
					context.save();
					context.restore();
					basket_obj.draw();

					//restore the coordinate frame (in case we wanted to draw other things)
					context.restore();

					//draw the fps counter
                	context.fillText("FPS: " + fps, 10, 10);
					++framesThisSecond;
				}
			});
		</script>
	</body>
</html>
